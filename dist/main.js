(()=>{"use strict";function e(e,t){e.fontSize=t.fontSize,e.fontName={family:t.fontFamily,style:"Regular"},e.textAlignHorizontal=t.textAlign.toUpperCase(),e.textAutoResize="WIDTH_AND_HEIGHT"}function t(e,t,a,i){t.push(e.name),a.push({layerName:e.name,time:(new Date).toISOString()}),function(e){let t;return function(...a){clearTimeout(t),t=setTimeout((()=>e.apply(this,a)),300)}}((()=>{figma.notify(`Automatically logged click on: ${e.name}`,{timeout:1e3})}))(),figma.ui.postMessage({type:"update-click-history",clickedLayers:t})}figma.showUI(__html__),figma.ui.resize(450,600);let a,i=[],n=[],o=0,l=1e3;function c(){o=0,a=setInterval((()=>{if(o<n.length){const e=n[o],t=figma.currentPage.findOne((t=>t.name===e.layerName));t&&(figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),figma.notify(`Replaying click on: ${t.name}`)),o++}else s()}),l)}function s(){clearInterval(a),a=null,figma.notify("Replay session stopped.")}figma.on("selectionchange",(()=>{const e=figma.currentPage.selection;e.length>0&&t(e[0],i,n)})),figma.ui.onmessage=o=>{if(console.log("Received message:",o),"log-click"===o.type){const e=figma.currentPage.selection;e.length>0?t(e[0],i,n):figma.notify("Please select a layer to log the click.")}else"generate-heatmap"===o.type?function(e){const t=e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{});figma.ui.postMessage({type:"display-heatmap",heatmapData:t})}(i):"clear-history"===o.type?function(e,t){e.length=0,t.length=0,figma.notify("Click history cleared."),figma.ui.postMessage({type:"clear-history"})}(i,n):"clear-heatmap"===o.type?(figma.ui.postMessage({type:"clear-heatmap"}),figma.notify("Heatmap cleared.")):"export-data"===o.type?async function(t){try{await figma.loadFontAsync({family:"Inter",style:"Regular"});const a=figma.createPage();a.name="UX Click Data Report",figma.currentPage=a;let i=40;const n=40,o=figma.createText();o.characters="UX Interaction Report: Click Data Analysis",e(o,{fontFamily:"Inter",fontSize:32,textAlign:"LEFT"}),o.x=n,o.y=i,a.appendChild(o),i+=50;const l=figma.createText(),c=new Set(t).size,s=t.length;l.characters=`This report captures a total of ${s} clicks across ${c} unique layers.`,e(l,{fontFamily:"Inter",fontSize:16,textAlign:"LEFT"}),l.x=n,l.y=i,a.appendChild(l),i+=80;const r=t.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{});for(const[t,o]of Object.entries(r)){const l=figma.createText();l.characters=`Layer: ${t}\nClicks: ${o}`,e(l,{fontFamily:"Inter",fontSize:16,textAlign:"LEFT"}),l.x=n,l.y=i,a.appendChild(l),i+=50}figma.notify("Click data report has been created successfully.")}catch(e){console.error("Error exporting click data:",e),figma.notify("Failed to export click data. Please try again.")}}(i):"start-replay"===o.type?(a?s():c(),figma.ui.postMessage({type:a?"replay-stopped":"replay-started"})):"set-replay-speed"===o.type&&(l=o.speed,a&&(s(),c()))}})();